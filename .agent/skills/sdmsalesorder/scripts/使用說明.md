# 資料庫結構抓取工具 - 使用說明

## 📋 工具概述

本工具提供三種方式來抓取 SDM 資料庫的結構資訊：

1. **Java 工具類** - 自動化抓取並生成 Markdown 文件
2. **SQL 腳本** - 在 SQL Developer 中手動執行
3. **命令列工具** - 快速執行和查看結果

---

## 🔧 方式一：使用 Java 工具類（推薦）

### 連接資訊

- **主機**: 10.10.208.38
- **埠號**: 1521
- **服務名稱**: db11g.ginko.com.tw

### 執行步驟

#### 1. 編譯 Java 類別

```bash
cd d:\CODE\SdmSaleOrder
javac -cp ".;lib\ojdbc8-19.3.0.0.jar" src\main\java\com\sdm\utility\DatabaseSchemaExtractorV2.java
```

#### 2. 執行工具

```bash
java -cp ".;lib\ojdbc8-19.3.0.0.jar;src\main\java" com.sdm.utility.DatabaseSchemaExtractorV2
```

#### 3. 輸入資料庫帳號密碼

執行後會提示輸入：
```
請輸入資料庫帳號: [輸入您的帳號]
請輸入資料庫密碼: [輸入您的密碼]
```

#### 4. 查看結果

工具會自動生成 `doc/database_schema_info.md` 文件，包含：

- ✅ 所有 SDM 相關表的列表
- ✅ 每個表的欄位詳細資訊
- ✅ 主鍵和外鍵約束
- ✅ 索引資訊
- ✅ 存儲過程和參數
- ✅ 視圖定義
- ✅ 觸發器
- ✅ 序列
- ✅ 資料統計

---

## 📝 方式二：使用 SQL 腳本

### 執行步驟

#### 1. 開啟 SQL Developer

連接到資料庫：
- **連接名稱**: TEST
- **用戶名**: [您的帳號]
- **密碼**: [您的密碼]
- **連接類型**: 基本
- **主機名**: 10.10.208.38
- **埠**: 1521
- **服務名**: db11g.ginko.com.tw

#### 2. 開啟 SQL 腳本

在 SQL Developer 中開啟：
```
d:\CODE\SdmSaleOrder\doc\scripts\extract_database_schema.sql
```

#### 3. 執行腳本

點擊「執行腳本」按鈕（F5）或選擇「執行腳本」選項。

#### 4. 查看結果

結果會顯示在「腳本輸出」視窗中。您可以：
- 複製結果到文字檔案
- 匯出為 Excel
- 直接在 SQL Developer 中查看

---

## 🚀 方式三：使用 Maven 執行

如果您的專案已配置 Maven，可以直接執行：

### 1. 添加 Maven 插件配置

在 `pom.xml` 中添加：

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>exec-maven-plugin</artifactId>
            <version>3.0.0</version>
            <configuration>
                <mainClass>com.sdm.utility.DatabaseSchemaExtractorV2</mainClass>
            </configuration>
        </plugin>
    </plugins>
</build>
```

### 2. 執行命令

```bash
mvn exec:java -Dexec.mainClass="com.sdm.utility.DatabaseSchemaExtractorV2"
```

---

## 📊 輸出文件格式

### Markdown 格式 (database_schema_info.md)

生成的文件包含以下章節：

```markdown
# SDM 資料庫結構資訊

## 基本資訊
- 資料庫位址
- Schema
- 抓取時間

## 1. SDM 相關表列表
表格形式列出所有表

## 2. 表欄位詳細資訊
每個表的欄位詳細說明

## 3. 主鍵資訊
主鍵約束

## 4. 外鍵資訊
外鍵約束和參照關係

## 5. 索引資訊
所有索引及其欄位

## 6. 存儲過程列表
所有存儲過程、函數、套件

## 7. 存儲過程參數
每個存儲過程的參數詳情

## 8. 視圖資訊
視圖定義的 SQL

## 9. 觸發器資訊
觸發器的完整定義

## 10. 序列資訊
序列的配置資訊

## 11. 資料統計
每個表的資料筆數
```

---

## 🔍 常見問題

### Q1: 連接失敗怎麼辦？

**錯誤訊息**: `ORA-12541: TNS:no listener`

**解決方案**:
1. 確認資料庫伺服器是否啟動
2. 檢查主機位址和埠號是否正確
3. 確認網路連接是否正常
4. 檢查防火牆設定

### Q2: 帳號密碼錯誤？

**錯誤訊息**: `ORA-01017: invalid username/password`

**解決方案**:
1. 確認帳號密碼是否正確
2. 檢查帳號是否被鎖定
3. 確認帳號是否有連接權限

### Q3: 找不到 JDBC 驅動？

**錯誤訊息**: `ClassNotFoundException: oracle.jdbc.driver.OracleDriver`

**解決方案**:
1. 確認 `ojdbc8-19.3.0.0.jar` 在 classpath 中
2. 檢查 JAR 檔案路徑是否正確
3. 可以從 Maven 中央倉庫下載 JDBC 驅動

### Q4: 權限不足？

**錯誤訊息**: `ORA-00942: table or view does not exist`

**解決方案**:
1. 確認帳號有查詢 USER_TABLES 等系統視圖的權限
2. 聯絡 DBA 授予必要的權限

### Q5: 輸出文件在哪裡？

**位置**: `d:\CODE\SdmSaleOrder\doc\database_schema_info.md`

如果找不到，請檢查：
1. 工具是否執行成功
2. 是否有寫入權限
3. 檢查控制台輸出的錯誤訊息

---

## 📦 所需依賴

### Oracle JDBC 驅動

確保專案中包含 Oracle JDBC 驅動：

**Maven 依賴** (已在 pom.xml 中):
```xml
<dependency>
    <groupId>com.oracle.database.jdbc</groupId>
    <artifactId>ojdbc8</artifactId>
    <version>19.3.0.0</version>
</dependency>
```

**手動下載**:
如果 Maven 無法下載，可以從 Oracle 官網下載：
https://www.oracle.com/database/technologies/jdbc-drivers-12c-downloads.html

---

## 🎯 使用建議

### 1. 定期更新

建議定期執行此工具以保持文件最新：
- 資料庫結構變更後
- 新增表或欄位後
- 修改存儲過程後

### 2. 版本控制

將生成的 `database_schema_info.md` 加入版本控制：
```bash
git add doc/database_schema_info.md
git commit -m "更新資料庫結構文件"
```

### 3. 整合到文件

可以將生成的內容整合到主要的系統分析文件中：
- 複製相關章節到 `資料庫設計文件.md`
- 更新 ER 圖
- 補充業務說明

### 4. 自動化

可以將此工具整合到 CI/CD 流程中：
```yaml
# GitHub Actions 範例
- name: Extract Database Schema
  run: |
    java -cp ".:lib/*" com.sdm.utility.DatabaseSchemaExtractorV2
    git add doc/database_schema_info.md
    git commit -m "Auto-update database schema"
```

---

## 📞 技術支援

如有問題，請聯絡：
- **開發團隊**: [待填寫]
- **DBA**: [待填寫]
- **專案經理**: [待填寫]

---

## 📝 更新記錄

| 版本 | 日期 | 作者 | 變更說明 |
|------|------|------|----------|
| 2.0 | 2026-01-26 | System | 更新連接資訊為 10.10.208.38，輸出格式改為 Markdown |
| 1.0 | 2026-01-26 | System | 初始版本 |

---

**文件結束**
